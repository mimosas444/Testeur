<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aulifa - Connexion</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #00c896;
      --primary-hover: #00b386;
      --bg-dark: #121218;
      --glass-bg: rgba(255, 255, 255, 0.07);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-color: #ffffff;
      --text-muted: #a0a0b0;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh; /* Utiliser min-height pour éviter les coupures sur petits écrans */
      overflow: hidden; /* Attention: peut couper le contenu si l'écran est très petit verticalement */
      position: relative;
    }

    /* Background Animation Shapes */
    .shape {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      z-index: -1;
      opacity: 0.6;
      animation: float 10s infinite ease-in-out alternate;
    }
    .shape-1 {
      width: 300px; height: 300px;
      background: #7b2cbf;
      top: -50px; left: -50px;
    }
    .shape-2 {
      width: 400px; height: 400px;
      background: var(--primary);
      bottom: -100px; right: -100px;
      animation-delay: -5s;
    }

    @keyframes float {
      0% { transform: translate(0, 0); }
      100% { transform: translate(30px, 50px); }
    }

    /* Glass Card */
    .container {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 40px;
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      width: 90%; /* Responsive width */
      max-width: 420px;
      text-align: center;
      animation: slideUp 0.6s ease-out;
      position: relative;
      z-index: 10;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .greeting {
      font-size: 14px;
      color: var(--primary);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    h2 {
      margin: 0 0 30px 0;
      font-size: 28px;
      font-weight: 700;
    }

    /* Input Group Styling */
    .input-group {
      position: relative;
      margin-bottom: 20px;
      text-align: left;
    }

    .input-group i {
      position: absolute;
      top: 50%;
      left: 15px;
      transform: translateY(-50%);
      color: var(--text-muted);
      transition: color 0.3s;
    }

    input {
      width: 100%;
      padding: 14px 14px 14px 45px; /* Space for icon */
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-size: 15px;
      transition: all 0.3s ease;
      outline: none;
    }

    input:focus {
      border-color: var(--primary);
      background: rgba(0, 0, 0, 0.4);
      box-shadow: 0 0 0 4px rgba(0, 200, 150, 0.1);
    }
    
    input:focus + i {
      color: var(--primary);
    }

    /* Button Styling */
    .btn-primary {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 200, 150, 0.3);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-primary:disabled {
      background: #444;
      cursor: not-allowed;
      transform: none;
    }

    /* Separator */
    .separator {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 20px 0;
      color: var(--text-muted);
      font-size: 13px;
    }
    .separator::before, .separator::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid var(--glass-border);
    }
    .separator span {
      padding: 0 10px;
    }

    /* Google Button Styling */
    .btn-google {
      width: 100%;
      padding: 12px;
      background: #ffffff;
      border: none;
      border-radius: 12px;
      color: #121218; /* Dark text for contrast */
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
    }

    .btn-google:hover {
      background: #f1f1f1;
      transform: translateY(-2px);
    }

    .google-icon {
      font-size: 18px;
      /* Using a gradient for the G logo is hard with just CSS, using standard colored icon logic roughly or simple color */
      color: #db4437; /* Google Red fallback */
      background: -webkit-linear-gradient(45deg, #4285F4, #DB4437, #F4B400, #0F9D58);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent; 
    }

    /* Loader Animation inside button */
    .loader {
      display: none;
      width: 18px;
      height: 18px;
      border: 2px solid #fff;
      border-bottom-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Switch Text */
    .switch {
      margin-top: 24px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .switch a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      margin-left: 5px;
      cursor: pointer;
      transition: color 0.2s;
    }
    
    .switch a:hover {
      text-decoration: underline;
    }

    /* Error Message */
    .error-msg {
      color: #ff4d4d;
      font-size: 13px;
      margin-top: 10px;
      min-height: 20px;
      opacity: 0;
      transition: opacity 0.3s;
    }
  </style>
</head>
<body>

  <div class="shape shape-1"></div>
  <div class="shape shape-2"></div>

  <div class="container">
    <div class="greeting" id="time-greeting">Bienvenue</div>
    <h2 id="form-title">Connexion</h2>
    
    <div class="input-group">
      <input type="email" id="email" placeholder="Adresse e-mail" required />
      <i class="fas fa-envelope"></i> </div>
    
    <div class="input-group">
      <input type="password" id="password" placeholder="Mot de passe" required />
      <i class="fas fa-lock"></i> </div>

    <button id="submit" class="btn-primary">
      <span class="btn-text">Se connecter</span>
      <span class="loader"></span>
    </button>

    <div class="separator">
      <span>OU</span>
    </div>

    <button id="google-btn" class="btn-google">
      <i class="fab fa-google google-icon"></i>
      <span>Continuer avec Google</span>
    </button>
    
    <div class="error-msg" id="error-message"></div>

    <div class="switch">
      <span id="switch-text">Pas encore de compte ?</span>
      <a id="toggle-link">S'inscrire</a>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    // Ajout des imports GoogleAuthProvider et signInWithPopup
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- Ta configuration Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyDE6doCDW_iU-JnxT0YRaeb6brZpJqKBKY",
      authDomain: "testeur-1e462.firebaseapp.com",
      projectId: "testeur-1e462",
      storageBucket: "testeur-1e462.firebasestorage.app",
      messagingSenderId: "67600594276",
      appId: "1:67600594276:web:9ed96e88d91245fdc23671",
      measurementId: "G-QD421ZB6NZ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const googleProvider = new GoogleAuthProvider(); // Initialisation du fournisseur Google

    // --- Logique UI & UX ---
    
    const elements = {
      title: document.getElementById("form-title"),
      btn: document.getElementById("submit"),
      googleBtn: document.getElementById("google-btn"), // Référence au bouton Google
      btnText: document.querySelector(".btn-text"),
      loader: document.querySelector(".loader"),
      toggleLink: document.getElementById("toggle-link"),
      switchText: document.getElementById("switch-text"),
      email: document.getElementById("email"),
      password: document.getElementById("password"),
      errorMsg: document.getElementById("error-message"),
      greeting: document.getElementById("time-greeting"),
      container: document.querySelector(".container")
    };

    let isLogin = true;

    // 1. Détection automatique de l'heure
    function setGreeting() {
      const hour = new Date().getHours();
      let text = "Bienvenue";
      if (hour >= 5 && hour < 12) text = "Bonjour";
      else if (hour >= 12 && hour < 18) text = "Bonne après-midi";
      else text = "Bonsoir";
      
      elements.greeting.textContent = text;
    }
    setGreeting();

    // 2. Basculement entre Connexion et Inscription
    elements.toggleLink.addEventListener("click", () => {
      isLogin = !isLogin;
      
      elements.title.style.opacity = 0;
      setTimeout(() => {
        elements.title.textContent = isLogin ? "Connexion" : "Créer un compte";
        elements.btnText.textContent = isLogin ? "Se connecter" : "S'inscrire";
        elements.switchText.textContent = isLogin ? "Pas encore de compte ?" : "Déjà un compte ?";
        elements.toggleLink.textContent = isLogin ? "S'inscrire" : "Se connecter";
        elements.errorMsg.style.opacity = 0;
        elements.title.style.opacity = 1;
      }, 200);
    });

    // 3. Gestion de la soumission EMAIL / PASSWORD
    elements.btn.addEventListener("click", async () => {
      const email = elements.email.value;
      const password = elements.password.value;

      if(!email || !password) {
        showError("Veuillez remplir tous les champs.");
        return;
      }

      setLoading(true);

      try {
        if (isLogin) {
          await signInWithEmailAndPassword(auth, email, password);
        } else {
          await createUserWithEmailAndPassword(auth, email, password);
        }
        window.location.href = "dashboard.html";
        
      } catch (error) {
        setLoading(false);
        handleError(error);
      }
    });

    // 4. Gestion de la connexion GOOGLE
    elements.googleBtn.addEventListener("click", async () => {
      // Pas besoin de vérifier email/mdp, c'est Google qui gère
      
      try {
        await signInWithPopup(auth, googleProvider);
        // Si succès :
        window.location.href = "dashboard.html";
      } catch (error) {
        handleError(error);
      }
    });

    function setLoading(state) {
      if (state) {
        elements.btn.disabled = true;
        elements.googleBtn.disabled = true; // On désactive aussi le bouton Google
        elements.btnText.style.display = "none";
        elements.loader.style.display = "block";
      } else {
        elements.btn.disabled = false;
        elements.googleBtn.disabled = false;
        elements.btnText.style.display = "block";
        elements.loader.style.display = "none";
      }
    }

    function handleError(error) {
      let message = "Une erreur est survenue.";
      console.log(error.code); // Pour le debug

      if(error.code === 'auth/invalid-credential') message = "Email ou mot de passe incorrect.";
      else if(error.code === 'auth/user-not-found') message = "Aucun compte trouvé.";
      else if(error.code === 'auth/wrong-password') message = "Mot de passe incorrect.";
      else if(error.code === 'auth/email-already-in-use') message = "Cet email est déjà utilisé.";
      else if(error.code === 'auth/weak-password') message = "Le mot de passe est trop faible.";
      else if(error.code === 'auth/invalid-email') message = "Format d'email invalide.";
      else if(error.code === 'auth/popup-closed-by-user') message = "Connexion Google annulée.";
      
      showError(message);
    }

    function showError(msg) {
      elements.errorMsg.textContent = msg;
      elements.errorMsg.style.opacity = 1;
      elements.container.style.animation = "shake 0.5s";
      setTimeout(() => elements.container.style.animation = "", 500);
    }
  </script>

  <style>
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
  </style>
</body>
</html>
